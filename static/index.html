<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Elix â€” Career Advisor</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">

<style>
  #loginCard {
    transition: all 0.6s ease-in-out;
    overflow: hidden;
  }

  #right {
    max-height: 0;
    opacity: 0;
    transition: all 0.6s ease-in-out;
  }

  #right.show {
    max-height: 2000px; /* large enough to fit dashboard */
    opacity: 1;
  }

  :root {
    --accent: #00eaff;
    --bg-gradient: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    --glass: rgba(255, 255, 255, 0.08);
    --border: rgba(255, 255, 255, 0.2);
  }

  body {
    font-family: 'Orbitron', Arial, sans-serif;
    background: var(--bg-gradient);
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
  }

  #loginCard {
    width: 380px;
    padding: 30px;
    border-radius: 16px;
    background: var(--glass);
    backdrop-filter: blur(12px);
    border: 1px solid var(--border);
    box-shadow: 0 8px 40px rgba(0,0,0,0.6);
    text-align: center;
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  h2 {
    color: var(--accent);
    text-shadow: 0 0 10px var(--accent);
    letter-spacing: 2px;
    margin-bottom: 20px;
  }

  input {
    width: 100%;
    padding: 12px 14px;
    margin: 10px 0;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.1);
    color: white;
    font-size: 1rem;
    outline: none;
    transition: 0.3s;
  }
  input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 10px var(--accent);
  }

  button {
    flex: 1;
    background: var(--accent);
    color: #111;
    border: none;
    padding: 12px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
    transition: 0.3s;
  }
  button:hover {
    background: white;
    box-shadow: 0 0 20px var(--accent),0 0 40px var(--accent);
  }
  button:active {
    transform: scale(0.95);
  }

  #chatbox {
    max-height:260px;
    overflow:auto;
    margin-top:12px;
    margin-bottom:8px;
  }
  .msg.user {
    text-align:right;
    background:var(--accent);
    color:#111;
    padding:8px 12px;
    border-radius:12px;
    margin:8px 0;
    display:inline-block;
  }
  .msg.elix {
    text-align:left;
    background:rgba(255,255,255,0.2);
    color:#fff;
    padding:8px 12px;
    border-radius:12px;
    margin:8px 0;
    display:inline-block;
  }
  #queryRow { display:flex; gap:8px; margin-top:8px; }
  #query {
    flex:1;
    padding:10px;
    border-radius:8px;
    border:1px solid var(--border);
    background:rgba(255,255,255,0.1);
    color:white;
  }
  #right { flex:1; display:flex; flex-direction:column; gap:12px; display:none; }

  .card {
    background: rgba(255,255,255,0.05);
    border-radius:12px;
    padding:14px;
    box-shadow:0 10px 30px rgba(0,0,0,0.3);
  }
  .small { font-size:0.9rem; color:#ddd; }
  .chart-row { display:flex; gap:12px; }
  .chart-card { flex:1; min-height:260px; display:flex; flex-direction:column; }
  .badge {
    background:#00eaff22;
    color:#00eaff;
    padding:6px 10px;
    border-radius:999px;
    display:inline-block;
    margin-right:6px;
  }
  .roadmap { display:flex; gap:12px; align-items:center; padding-top:8px; }
  .road-step {
    background:rgba(255,255,255,0.08);
    padding:8px 12px;
    border-radius:10px;
    box-shadow:0 6px 14px rgba(0,0,0,0.2);
    margin-bottom:6px;
  }
  .downloadBtn { background:#ff0077; margin-top:10px; color:white; cursor:pointer; }
  .plotly-chart { width:100%; height:260px; }
</style>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="loginCard">
  <h2>ðŸš€ Elix Login</h2>
  <div id="loginForm">
    <input id="username" placeholder="Username (demo: kirubha)" />
    <input id="password" placeholder="Password (demo: 12345)" type="password" />
    <div style="display:flex; gap:10px; margin-top:12px;">
      <button onclick="doLogin()">Login</button>
      <button onclick="doGuest()" style="background:#ff0077; color:white;">Guest</button>
    </div>
  </div>

  <div id="chatPanel" style="display:none; margin-top:10px;">
    <div id="chatbox"></div>
    <div id="queryRow">
      <input id="query" placeholder="Enter Student ID, Name, or skill" onkeydown="if(event.key==='Enter') sendQuery()" />
      <button onclick="sendQuery()">Ask</button>
    </div>
    <button class="downloadBtn" id="downloadBtn" style="display:none" onclick="downloadPDF()">Download Career PDF</button>
  </div>
</div>

<!-- Dashboard -->
<div id="right">
  <div class="card" id="profileCard">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <h3 id="profileName">Student Profile</h3>
        <div class="small" id="profileMeta">Enter ID to load insights</div>
      </div>
      <div id="levelBadge" class="badge">â€”</div>
    </div>
  </div>

  <div class="chart-row">
    <div class="card chart-card" id="marksCard">
      <strong>Academic Snapshot</strong>
      <div id="marksPlot" class="plotly-chart" style="margin-top:8px;"></div>
    </div>
    <div class="card chart-card" id="careerCard">
      <strong>Career Suggestions</strong>
      <div id="treemapPlot" class="plotly-chart" style="margin-top:8px;"></div>
    </div>
  </div>

  <div class="chart-row">
    <div class="card chart-card" id="radarCard">
      <strong>Skill Fit (Radar)</strong>
      <div id="radarPlot" class="plotly-chart" style="margin-top:8px;"></div>
    </div>
    <div class="card chart-card" id="roadmapCard">
      <strong>Roadmap</strong>
      <div id="roadmapArea" style="margin-top:12px;"></div>
    </div>
  </div>

  <div class="card" id="extrasCard">
    <strong>Internships & Certifications</strong>
    <div id="internshipsList" class="small" style="margin-top:8px"></div>
    <div id="certList" class="small" style="margin-top:8px"></div>
  </div>
</div>

<script>
const API = "https://elix-career-advisor.onrender.com"; // backend URL
let sessionId = null;
let lastInsights = null;

// chat helper
function appendChat(sender,text){
  const box=document.getElementById("chatbox");
  const el=document.createElement("div");
  el.className=sender==="user"?"msg user":"msg elix";
  el.innerText=text;
  box.appendChild(el);
  box.scrollTop=box.scrollHeight;
}

// login / guest
async function doLogin(){
  const u=document.getElementById("username").value;
  const p=document.getElementById("password").value;
  try{
    const res=await fetch(API+"/login",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({username:u,password:p})});
    const j=await res.json();
    sessionId=j.session_id;
    showChat();
  }catch(e){alert("Login failed"); console.error(e);}
}
async function doGuest(){
  try{
    const res=await fetch(API+"/login",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({})});
    const j=await res.json();
    sessionId=j.session_id;
    showChat();
  }catch(e){alert("Guest start failed");}
}

// show chat panel
function showChat() {
  document.getElementById("loginForm").style.display = "none";
  document.getElementById("chatPanel").style.display = "block";
  appendChat("elix", "Hi! I'm Elix. Enter your Student ID, Name or skill to get personalized career insights.");

  // Expand dashboard smoothly
  const dashboard = document.getElementById("right");
  dashboard.classList.add("show");
}

// send query and fetch advice
async function sendQuery(){
  const q=document.getElementById("query").value.trim();
  if(!q) return;
  appendChat("user",q);
  appendChat("elix","Thinking...");
  try{
    const res=await fetch(API+"/ask",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({query:q,session_id:sessionId})});
    const j=await res.json();
    const box=document.getElementById("chatbox");
    if(box.lastChild.innerText==="Thinking...") box.removeChild(box.lastChild);
    appendChat("elix",j.answer || "No advice found.");
    if(j.insights){
      lastInsights=j.insights;
      renderInsights(j.insights);
      document.getElementById("downloadBtn").style.display="inline-block";
    }
    speak(j.insights ? j.insights.summary_text : j.answer);
  }catch(e){console.error(e); appendChat("elix","âš  Server error.");}
}

// speak advice
function speak(text){
  if(!text || !('speechSynthesis' in window)) return;
  const t=new SpeechSynthesisUtterance(text);
  t.lang="en-IN";
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(t);
}

// render dashboard cards
function renderInsights(data){
  document.getElementById("right").style.display="flex";
  document.getElementById("profileName").innerText = `${data.name} (ID: ${data.student_id})`;
  document.getElementById("profileMeta").innerText = `Domain: ${data.domain} â€¢ GPA: ${data.gpa}`;
  document.getElementById("levelBadge").innerText = data.performance.level;

  document.getElementById("internshipsList").innerHTML = 
    (data.internships||[]).map(i => `â€¢ ${i}<br>`).join("") || "<div class='small'>No internships</div>";

  document.getElementById("certList").innerHTML = 
    (data.certifications||[]).map(c => `â€¢ ${c}<br>`).join("") || "<div class='small'>No certifications</div>";

  const marksTrace={x:["10th (%)","12th (%)","GPA (scaled)"],y:[data.marks["10th"]||0,data.marks["12th"]||0,(data.gpa||0)*10],type:'bar',marker:{color:['#00eaff','#00C853','#FF9800'],line:{width:1.2,color:'#fff'}}};
  Plotly.newPlot('marksPlot',[marksTrace],{margin:{t:10,b:30,l:30,r:10},yaxis:{range:[0,100]},paper_bgcolor:'transparent',plot_bgcolor:'transparent'},{responsive:true});

  const treemapTrace={type:"treemap",labels:(data.career_suggestions||[]).map(c=>c.career),parents:(data.career_suggestions||[]).map(_=>""),values:(data.career_suggestions||[]).map(c=>c.weight),textinfo:"label+value+percent entry",hovertemplate:"%{label}: %{value}%<extra></extra>"};
  Plotly.newPlot('treemapPlot',[treemapTrace],{margin:{t:10,b:10}},{responsive:true});

  const radarTrace={type:'scatterpolar',r:data.radar.values||[],theta:data.radar.labels||[],fill:'toself',marker:{color:'#00eaff'},hovertemplate:'%{theta}: %{r}<extra></extra>'};
  Plotly.newPlot('radarPlot',[radarTrace],{polar:{radialaxis:{visible:true,range:[0,100]}},margin:{t:10}},{responsive:true});

  const roadmapArea=document.getElementById("roadmapArea");
  roadmapArea.innerHTML="";
  (data.roadmap||[]).forEach(step=>{
    const div=document.createElement("div");
    div.className="road-step";
    div.innerHTML = `<strong>${step.step}</strong><div class="small">${step.desc}</div>`;
    roadmapArea.appendChild(div);
  });
}

// download PDF
function downloadPDF(){
  if(!lastInsights || !lastInsights.student_id){ alert("No student selected"); return; }
  window.open(API+"/download/"+encodeURIComponent(lastInsights.student_id),"_blank");
}
</script>

</body>
</html>
